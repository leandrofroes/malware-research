// x64dbg script to find the call to the main_main function in Go binaries.
// Author: Leandro Fr√≥es
// Date: 2023-05-10

bpc
bphc
bpmc

// Simple check to see if it's a PE32 or PE32+ file.
SizeOfType void*
cmp $result, 8
jne find_x32_pattern

// Search using the x64 pattern.
find mem.base(cip), "488b05????????488d15????????ffd08b05????????"
cmp $result, 0
je pattern_not_found
set $base_addr, $result
set $offset, 0xE
jmp main_main_found

// Search using the x86 pattern.
find_x32_pattern:

find mem.base(cip), "8b05????????8d15????????ffd08d05????????"
cmp $result, 0
je pattern_not_found
set $base_addr, $result
set $offset, 0xC

// Pattern found. Set a bp and run to reach to our target.
main_main_found:

set $main_main_addr, $base_addr + $offset
bp $main_main_addr
run
log "main_main address found at 0x{$main_main_addr}"
jmp exit

// Pattern search failed.
pattern_not_found:

log "main_main address not found."

exit:

ret